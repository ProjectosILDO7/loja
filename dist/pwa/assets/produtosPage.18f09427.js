import{Q as K}from"./QSpace.fae20777.js";import{_ as Y,r as m,U as Z,o as G,V as H,aK as g,L as q,M as C,N as i,aL as W,aM as A,f as t,Y as d,q as w,$ as X,aN as $,Z as S,O as z,Q as _,aO as V,P as ee}from"./index.c57e1df5.js";import{Q as D}from"./QImg.024e7afb.js";import{a as oe,Q as ae}from"./QTable.c75b471b.js";import{Q as te}from"./QForm.57222d6e.js";import{Q as M}from"./QTd.545bfc1a.js";import{Q as re}from"./QPage.39b9a795.js";import{Q as le,a as se}from"./QLayout.031ceddd.js";import{db as u}from"./localbase.0d6b512d.js";import{f as ie}from"./formatNumber.c19a9984.js";import{n as ne}from"./notify.09de74ef.js";import"./QMenu.12cb183b.js";import"./format.609662aa.js";import"./rtl.b51694b1.js";import"./use-quasar.ccf7ad9b.js";const R=n=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"AOA"}).format(n),de=[{name:"img_url",field:"img_url",label:"Imagem",sortable:!0,align:"left"},{name:"produto",field:"produto",label:"nome de produto",sortable:!0,align:"left"},{name:"categoria",field:"categoria",label:"Categoria a que pertence",sortable:!0,align:"left"},{name:"quantidade",field:"quantidade",label:"Quant.",sortable:!0,align:"left"},{name:"preco",field:"preco",label:"Pre\xE7o unit\xE1rio",sortable:!0,align:"left",format:n=>R(n)},{name:"impostoIVA",field:"impostoIVA",label:"Imposto IVA",sortable:!0,align:"left",format:n=>R(n)},{name:"data",field:"data",label:"Data de registro",sortable:!0,align:"left"},{name:"options",field:"options",label:"Op\xE7\xF5es",align:"left"}],ce={components:{},setup(){const n="produtos",s=m(""),v=m(!0),{notifyError:o,notifyinfo:O}=ne(),y=m(""),e=m([]),Q=Z(),f=m(!1),F=m([]),r=m({categoria:"",produto:"",quantidade:0,preco:0,valorAcrescentado:5,data:new Date().toJSON().slice(0,10),imageUrl:""}),j=()=>{r.value.preco=r.value.preco.replace(/[^\d.]/g,"")},B=l=>{const a=l.target.files[0];if(a){const p=new FileReader;p.onload=b=>{r.value.imageUrl=b.target.result},p.readAsDataURL(a)}},U=()=>{r.value={categoria:"",produto:"",quantidade:0,preco:0,valorAcrescentado:5,data:new Date().toJSON().slice(0,10),imageUrl:""}},L=async l=>{try{const a=await u.collection(n).doc(l).get();r.value.categoria=a.categoria,r.value.produto=a.produto,r.value.preco=a.preco,r.value.preco=a.preco,r.value.imageUrl=a.imageUrl.imageUrl,r.value.quantidade=a.quantidade,y.value=l,f.value=!0}catch(a){console.log(a.message)}},T=()=>{f.value=!0,y.value="",U()},J=l=>{W.create({title:"Confirme",message:"Tens a certeza que pretendes apagar esse produto?",cancel:!0,persistent:!0}).onOk(async()=>{await u.collection(n).doc(l).delete(),h()}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{})},E=async()=>{try{if(e.value.find(a=>a.produto===r.value.produto)){g.create({message:"O produto que pretendes registrar j\xE1 existe",position:"top",icon:"mdi-check-circle",color:"red-10"});return}else if(y.value){if(A.show(),r.value.imageUrl){const a={produto:r.value.produto,imageUrl:r.value.imageUrl},{produto:p,categoria:b,preco:c,quantidade:I,data:x,valorAcrescentado:P}=r.value,k=P/100*c;await u.collection(n).doc(y.value).update({produto:p,categoria:b.categoria,preco:c,impostoIVA:k,valorAcrescentado:k+c,quantidade:I,data:x,imageUrl:a}),u.objectStorage,g.create({message:"O produto foi actualizado com sucesso",position:"top",icon:"mdi-check-circle",color:"green-10"})}f.value=!1,U(),f.value=!1}else if(r.value.imageUrl){const a={produto:r.value.produto,imageUrl:r.value.imageUrl};console.log(a),A.show();const{produto:p,categoria:b,preco:c,quantidade:I,data:x,valorAcrescentado:P}=r.value,k=P/100*c;await u.collection(n).add({produto:p,categoria:b.categoria,preco:c,impostoIVA:k,valorAcrescentado:k+c,quantidade:I,data:x,imageUrl:a}),g.create({message:"Produto salvo com sucesso",position:"top",icon:"mdi-check-circle",color:"green-10"}),f.value=!1,U()}}catch(l){console.log(l.message),g.create({message:l.message,position:"top",icon:"mdi-close-circle-outline",color:"red-10"})}finally{A.hide(),h()}};G(()=>{h(),N(),H.getItem("acesso")!="admin"&&(O("Caro funcion\xE1rio, existem \xE1rea de acesso exclusivo!."),Q.push({name:"vendas"}))});const h=async()=>{try{v.value=!0;const l=await u.collection(n).get({keys:!0});e.value=l.map(a=>({...a.data,key:a.key}))}catch(l){g.create({message:l.message,position:"top",icon:"mdi-close-circle-outline",color:"red-10"})}finally{v.value=!1}},N=async()=>{try{v.value=!0;const l=await u.collection("categorias").get({keys:!0});F.value=l.map(a=>({...a.data,key:a.key}))}catch(l){g.create({message:l.message,position:"top",icon:"mdi-close-circle-outline",color:"red-10"})}finally{v.value=!1}};return{columns:de,rows:e,loading:!1,addProdutos:E,filter:s,deleteItem:J,form:r,showForm:T,formularioCad:f,cleanForm:U,editForm:L,carregarInfoCateg:N,categorias:F,handleFileUpload:B,formatarMoeda:j,formatCurrency:ie}}},me={class:"row"},ue=d("div",{class:"col-6"},[d("p",{class:"text-body1"},[ee("Informa\xE7\xF5es de produtos & "),d("b",null,"Stock")])],-1),fe={class:"row justify-center"},pe={class:"col-4"},ge={class:"col-4"},ve={class:"col-4"},ye={class:"col-4"},be={class:"col-4"},ke={class:"col-4"};function we(n,s,v,o,O,y){return q(),C(le,null,{default:i(()=>[t(se,null,{default:i(()=>[t(re,{padding:""},{default:i(()=>[d("div",me,[ue,t(K),t(w,{flat:"",dense:"",icon:"mdi-basket-plus",color:"green-10","no-caps":"",onClick:o.showForm},null,8,["onClick"]),t(w,{dense:"",flat:"",icon:"mdi-format-list-bulleted",onClick:s[0]||(s[0]=e=>o.formularioCad=!1)})]),t(X),d("div",fe,[o.formularioCad?(q(),C(te,{key:0,onSubmit:$(o.addProdutos,["prevent"])},{default:i(()=>[d("div",pe,[d("input",{dense:"",outlined:"",type:"file",onChange:s[1]||(s[1]=(...e)=>o.handleFileUpload&&o.handleFileUpload(...e)),class:"q-mt-sm",accept:"image/*"},null,32),t(S,{square:"",size:"100px","font-size":"82px","text-color":"white"},{default:i(()=>[o.form.imageUrl?(q(),C(D,{key:0,src:o.form.imageUrl,alt:o.form.produto,style:{"max-width":"100%"}},null,8,["src","alt"])):z("",!0)]),_:1})]),d("div",ge,[t(oe,{dense:"",outlined:"",modelValue:o.form.categoria,"onUpdate:modelValue":s[2]||(s[2]=e=>o.form.categoria=e),options:o.categorias,label:"Selecione uma categoria","option-value":"id","option-label":"categoria","map-options":"","emit-value":"",class:"q-mt-sm","lazy-rules":"",rules:[e=>!!e||"Porfavor informe o nome da categoria"]},{prepend:i(()=>[t(_,{name:"mdi-shape-plus"})]),_:1},8,["modelValue","options","rules"])]),d("div",ve,[t(V,{outlined:"",dense:"",type:"text",label:"Novo produto",class:"q-mt-sm",modelValue:o.form.produto,"onUpdate:modelValue":s[3]||(s[3]=e=>o.form.produto=e),"lazy-rules":"",rules:[e=>e&&e.length>0||"Porfavor informe o nome da categoria"]},{prepend:i(()=>[t(_,{name:"mdi-basket-plus"})]),_:1},8,["modelValue","rules"])]),d("div",ye,[t(V,{outlined:"",dense:"",type:"number",label:"Quantidade em stock",class:"q-mt-sm",modelValue:o.form.quantidade,"onUpdate:modelValue":s[4]||(s[4]=e=>o.form.quantidade=e),"lazy-rules":"",rules:[e=>!!e||"Porfavor informe a do produto em stock"]},{prepend:i(()=>[t(_,{name:"mdi-numeric"})]),_:1},8,["modelValue","rules"])]),d("div",be,[t(V,{outlined:"",dense:"",type:"text",label:"Pre\xE7o de venda",class:"q-mt-sm",modelValue:o.form.preco,"onUpdate:modelValue":s[5]||(s[5]=e=>o.form.preco=e),"lazy-rules":"",rules:[e=>!!e||"Porfavor informe o pre\xE7o do produto"],onInput:o.formatarMoeda,before:o.formatCurrency(o.form.preco)},{prepend:i(()=>[t(_,{name:"mdi-chess-bishop"})]),_:1},8,["modelValue","rules","onInput","before"])]),d("div",ke,[t(w,{type:"submit",dense:"",color:"green-10",class:"full-width q-mt-sm",label:"Cadastrar produto",icon:"mdi-content-save-outline"})])]),_:1},8,["onSubmit"])):z("",!0)]),o.formularioCad==!1?(q(),C(ae,{key:0,dense:"",rows:o.rows,columns:o.columns,"row-key":"name",class:"q-mt-md",loading:o.loading,filter:o.filter},{top:i(()=>[t(V,{dense:"",outlined:"",class:"",label:"Procurar",modelValue:o.filter,"onUpdate:modelValue":s[6]||(s[6]=e=>o.filter=e)},{append:i(()=>[t(_,{name:"mdi-magnify"})]),_:1},8,["modelValue"])]),"body-cell-img_url":i(e=>[t(M,{props:e},{default:i(()=>[t(S,{square:"",size:"80px","font-size":"82px","text-color":"white"},{default:i(()=>[t(D,{src:e.row.imageUrl.imageUrl},null,8,["src"])]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-options":i(e=>[t(M,{props:e,class:"q-gutter-sm"},{default:i(()=>[t(w,{size:"sm",flat:"",outline:"",dense:"",icon:"mdi-file-edit",color:"green-10",onClick:Q=>o.editForm(e.row.key)},null,8,["onClick"]),t(w,{size:"sm",flat:"",outline:"",dense:"",icon:"mdi-delete-outline",color:"red-10",onClick:Q=>o.deleteItem(e.row.key)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","filter"])):z("",!0)]),_:1})]),_:1})]),_:1})}var Se=Y(ce,[["render",we]]);export{Se as default};
